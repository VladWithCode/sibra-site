{{define "content"}}
<script>
    document.addEventListener("DOMContentLoaded", e => {
        let searchForm = document.getElementById("property-search")
        let contractPill = document.getElementById("contract-pill")
        let contractBtns = document.querySelectorAll("[data-contract-btn]")

        for (let btn of contractBtns) {
            let contract = btn.dataset.contractBtn
            let offsetLeft = btn.offsetLeft
            btn.addEventListener("click", () => {
                let currentBtn = document.querySelector("[data-contract-active=\"true\"]")
                if (currentBtn === btn)
                    return

                let currentContract = searchForm.dataset.contract
                let tl = gsap.timeline({ duration: 0.2 })
                searchForm.dataset.contract = contract
                tl.to(contractPill, { x: `${offsetLeft}px` })
                tl.to(btn, { fontWeight: "bold", color: "#334155" }, "<")
                tl.to(currentBtn, { fontWeight: "normal", color: "#fafaf9" }, "<")

                currentBtn.dataset.contractActive = "false"
                btn.dataset.contractActive = "true"

                searchForm.action = searchForm.action.replace(currentContract, contract)
            })
        }

        searchForm.action += "/venta"
    })
</script>
<div class="space-y-16">
    <div class="relative overflow-hidden px-2 xl:px-4">
        <div class="absolute inset-0 z-0 h-full w-full px-2 xl:px-4">
            <img 
                class="h-full w-full rounded-lg object-cover object-[left_center] brightness-75 xl:w-full"
                src="/static/img/hero_large.webp" alt="Imagen de cabecera"
            >
        </div>
        <form
            action="/propiedades"
            class="relative z-10 inset-0 bg-slate-900/50 p-4 py-48 lg:py-60 rounded-lg"
            id="property-search"
            data-contract="venta">
            <div class="flex flex-col items-center justify-center gap-6 xl:gap-16 max-w-2xl lg:max-w-5xl mx-auto">
                <h1 class="text-zinc-50 font-bold text-4xl xl:text-7xl text-center" style="text-shadow: 0 0 10px rgba(22,22,24,1);">
                    Encuentra tu hogar de ensueño
                </h1>
                <div class="flex items-stretch rounded-lg w-6/7 mx-auto">
                    <input 
                        class="w-5/6 h-full px-4 py-2.5 bg-stone-50 rounded-s-lg outline-indigo-800 xl:text-lg" 
                        type="search" 
                        name="search" 
                        id="home_search"
                        placeholder="Tierra Blanca, 34139...">
                    <button class="flex-1 basis-auto flex items-center justify-center bg-indigo-600 px-4 rounded-e-lg" type="submit">
                        <svg class="w-6 h-6 rounded-s fill-zinc-50">
                            <use href="/static/svg/sprites.svg#search"></use>
                        </svg>
                    </button>
                </div>
            </div>
        </form>
    </div>
    <div class="text-zinc-800 px-2 xl:px-4 space-y-4">
        <div class="px-4 space-y-4">
            <h2 class="text-4xl lg:text-5xl font-bold text-center">Propiedades Destacadas</h2>
            <div class="space-y-1">
                <p class="px-4 text-center text-current/60">
                    Estas son las propiedades que Sibra Durango ha elegido como destacadas.
                </p>
                <p class="px-4 text-center text-current/60">
                    Aquí encontrarás una selección exclusiva de inmuebles que hemos elegido por su excelente ubicación, diseño, y valor.
                </p>
            </div>
        </div>
        <div class="grid grid-flow-col grid-rows-2 auto-cols-[17.5rem] h-[27rem] gap-4 overflow-auto py-4 mx-auto">
            {{range $idx, $prop := .FeatProps}}
            {{$rowSpan := (GetRowSpan $idx)}}
            <div class="relative flex flex-col justify-between row-span-{{$rowSpan}} col-span-1 bg-stone-500/30 rounded-lg shadow-lg shadow-zinc-400 p-4 overflow-hidden">
                {{if ne $prop.MainImg ""}}
                <img src="/static/properties/{{$prop.Id}}/{{$prop.MainImg}}" alt="Fotografia fraccionamiento Las Flores" class="absolute -z-10 inset-0 {{if eq $rowSpan "2"}}h-full max-w-full{{else}}w-full max-h-full{{end}}  object-center object-cover m-auto">
                {{else if gt (len $prop.Images) 0}}
                <img src="/static/properties/{{$prop.Id}}/{{index $prop.Images 0}}" alt="Fotografia fraccionamiento Las Flores" class="absolute -z-10 inset-0 {{if eq $rowSpan "2"}}h-full max-w-full{{else}}w-full max-h-full{{end}}  object-center object-cover m-auto">
                {{end}}
                <h3 class="text-xl font-bold text-zinc-50" style="text-shadow: 0px 0px 8px rgba(0,0,0,1)">{{$prop.Address}}, {{$prop.NbHood}} {{$prop.Zip}}</h3>
                <a href="/propiedades/{{$prop.Contract}}/{{$prop.Id}}" class="flex items-center w-fit bg-zinc-50 text-zinc-800 font-semibold py-1 px-2 rounded capitalize">
                    <span>Ver más</span>
                    <svg class="inline-block w-6 h-6 -mr-2 fill-current">
                        <use href="/static/svg/sprites.svg#angle"></use>
                    </svg>
                </a>
            </div>
            {{end}}
        </div>
    </div>
    <div class="space-y-4">
        <h2 class="text-4xl xl:text-5xl font-bold text-center">Propiedades Nuevas</h2>
        <div class="space-y-1 text-center text-current/60 mx-auto px-4">
            <p class="">
                Estas son las propiedades más nuevas en nuestro catalogo.
            </p>
            <p class="">
               Encuentra grandes oportunidades para comenzar o expandir tu patrimonio con ayuda de Sibra Durango. 
            </p>
        </div>
        <div class="flex gap-4 overflow-auto py-4 px-2 xl:px-4 mx-auto">
            {{range $idx, $prop := .NewProps}}
            <div class="basis-4/5 grow-0 shrink-0 md:basis-72">
                {{template "prop-card" $prop}}
            </div>
            {{end}}
        </div>
    </div>
    <div class="py-8"></div>
    <form 
        hx-get="/propiedades/todas"
        class="space-y-8 xl:flex xl:items-center xl:gap-16 px-4 max-w-2xl lg:max-w-5xl mx-auto">
        <div class="basis-1/3 text-center space-y-1">
            <h2 class="text-xl xl:text-2xl font-bold">Busca algún vecindario</h2>
            <p class="text-sm text-current/60">Ciudad, Colonia, Código Postal</p>
        </div>
        <div class="flex items-center rounded-lg xl:basis-full">
            <input 
                type="search" 
                name="search" 
                id="general-search"
                class="pl-3 pr-1 py-4 bg-slate-200 basis-3/4 rounded-s-md outline-offset-2 outline-slate-400 focus:outline-2"
                placeholder="Buscar por Ciudad, Código Postal, Estado...">
            <button class="flex-1 text-stone-50 bg-indigo-600 rounded-e-md px-2 py-4" type="submit">Buscar</button>
        </div>
    </form>
    <div class="py-8"></div>
</div>
{{end}}
